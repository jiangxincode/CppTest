使用GLib重构部分代码。